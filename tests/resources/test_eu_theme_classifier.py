import importlib
import unittest
import pandas as pd

from ndl_core_data_pipeline.resources.embedding.eu_theme_classifier import classify_eu_themes

class TestEUThemeClassifier(unittest.TestCase):

    def test_classify_eu_themes_example(self):
        data = [
            {"name": "corn_prices.csv", "description": "Market rates for wheat and corn"},
            {"name": "green_energy_report.pdf", "description": "Impact of wind farms on local bird biodiversity"},
            {"name": "unknown.txt", "description": "random text about nothing"},
        ]
        df = pd.DataFrame(data)

        tagged_df = classify_eu_themes(df)
        print(tagged_df[['name', 'predicted_themes']])

        expected = [["AGRI"], ["ENVI", "AGRI", "ENER"], []]
        result = tagged_df["predicted_themes"].tolist()
        self.assertEqual(result, expected)

    def test_classify_eu_themes_real_example(self):
        data = [
            {"identifier": "x", "name": "IoS: 52: Warehousing And Support Activities For Transportation: Weights", "description": "", "text": "Title, IoS: 52: Warehousing And Support Activities For Transportation: Weights"},
            {"identifier": "y", "name": "UK greenhouse gas emissions: other technical reports", "description": "Supplementary technical reports relating to greenhouse gas emissions.", "text": "Background quality report This report provides a summary of quality issues relating to statistics on UK territorial greenhouse gas (GHG) emissions, as well as providing details of the statistical publications we produce and the different approaches taken to reporting UK greenhouse gas emissions. The Department for Energy Security and Net Zero (DESNZ) official statistics for UK emissions are based on the UK’s greenhouse gas inventory (compiled by a consortium led by Ricardo Energy & Environment on behalf of DESNZ), and on DESNZ energy statistics. Greenhouse gas emissions statistics information wo sets of questions and answers about the national and subnational greenhouse gas emissions statistics."},
            {"identifier": "z", "name": "PM remarks at the Show Racism the Red Card reception: 2 June 2025", "description": "Prime Minister's remarks at the Show Racism the Red Card reception in Downing Street.", "text": "Thank you, Shaka [Hislop] and thank you for all that you’ve done and all that you have inspired—because to look out here so many years after the instant you described a moment ago and see so many people who’ve contributed to this really important campaign and cause—must be inspiring for you. It’s certainly inspiring for us with this great charity, Show Racism the Red Card. And as you said, it was almost 30 years ago now from that moment in the petrol station near Saint James’s Park, where you were facing appalling racism and abuse. I think a moment ago you told me you’d just got married. You were newly married, simply stopping to fill up the car, facing that abuse until the perpetrators realised that the person they were targeting was the Newcastle goalkeeper that they so admired. In that moment, they changed completely and you saw the power of football with that—to change our country—and were determined to seize it and to build something better out of that moment. The way Shaka put it to me just now was that at 100 yards he faced racism and hatred; at 100 feet, when people were closer, he experienced friendship and a wanting to have his autograph. That, I think, has driven you—this sense that if we can pull people closer and act in that way, the power of doing so is phenomenal. In that particular case, it was the very same individual whose behaviour changed in a very short period of time. And here we are, years later, in Downing Street, and it is my privilege to be able to host you and to host everybody here in this garden with a charity that has reached 1.3 million people. And not just the work that’s been done in football grounds themselves, but in schools, in workplaces, and stadiums across the country. And of course, with so many others that have joined this mission—all of those that are here tonight, but many other people who can’t be here this evening—have played a huge part as well. And we say thanks to them. We’ve got pioneers like Trevor Sinclair, Anita Asante, Richard Offiong, and Chris Hughton here today. We’re so special. Thank you to all of them and people across the football world, all doing so much in their own right to support this cause. So not just on behalf of myself as Prime Minister, but on behalf of the whole country, I’d like to say a huge thank you. And when I say the whole country, I always remind myself that it’s a privilege to stand here, and there are millions of people who would love to stand here this evening and say thank you to you for all that you have done. I say that as Prime Minister, but I say it on behalf of all the people who would love to stand here and say hello to you and say thank you to you—people whose lives have been affected. As you said, Shaka, the people who you won’t even know, won’t ever meet, but whose lives have been changed by the work that has been done. And that’s the power of inspiration—reaching beyond the immediate and bringing other people in behind this important work and using the power of football to fight racism and build a better, more inclusive Britain. And there’s only one further step tonight that we need to take. I’ve been determined to do it for a long time, which is to put some five-a-side goals back here. I’m a season ticket holder, go to football now, but I’ve been going for many years like other people here. And I do remember when going to football was a very different experience than it is today, especially for fans and players from certain communities, it was a very different experience. And I remember that as a fan watching football week in, week out. So yes, we celebrate today how far we’ve come—and we should—but it is also a call to action because we know we’ve got to go further. And we can’t be complacent, even within football itself. Never forget, it was only four years ago, in the summer of 2021, when those young England stars faced appalling abuse after that penalty shootout against Italy in the finals of the Euros. But yet that team, after that experience, I can still remember the players going up to take those penalties and the aftermath. And then the outpouring of hatred, vitriol, abuse that came, which I think was shocking for them—certainly shocking for all of us, including for me—because just as we think that we’ve made great strides forward, there’s a brutal reminder: not so fast. Don’t be complacent. And yet that team, those young players, supported by Gareth, stood up and showed real leadership in the face of that hatred and that abuse. They used the honour of representing our country in our national game to help us build a better nation, a more inclusive nation, and to make us proud of our national identity, of who we are and what we stand for. And that was a brilliant response to what happened just four years ago and enabled us to bring the country together through that shared emotion of football. And that’s the power of football that we’re all here to harness today, because it doesn’t matter who you are, where you come from, what you do for a living—the basic joy of stepping onto a pitch and kicking a ball is deep in our humanity. And I say this from personal experience: football is for everyone. There’s something special about stepping onto the pitch where almost everything else falls away, and it just depends on you and your teammates around you. And it’s a reminder of the power of football and that football is for everyone. Even for me, I am unashamedly ambitious about how we can use the unifying power of football to educate, as you are doing, to fight discrimination, bring our communities together, and promote health and fitness. And it really gives people a leg up with skills, employability, and confidence. And for young people, to my mind, confidence is probably the number one most valuable thing in whatever they do—the confidence it gives and the way that football contributes to all of that. And many of you here are leading the way with that, including many of our football clubs. But just to take some examples that I’ve seen from Arsenal: David Dein pioneering the Twinning Project, using football to reduce reoffending. What a brilliant project that is—to go into prisons and to work with young people to give them a chance when they come out of not going back into prison in the future through the Twinning Project. The Dirt Is Good campaign—tackling the stigma of stains on clothes and bringing down the barriers that have stopped girls playing sport for too long. And how far have we come because of campaigns like that with our women’s football, which has gone through massive strides in the last few years. And the support of Adidas to create new local pitches for people from all backgrounds to come and play, including in my own constituency—what a valuable contribution. Because that gives sport to children and young people who wouldn’t otherwise have it and gives them the chance not to be mucking about on the streets doing other things which wouldn’t do them any good in the long term."},
            {"identifier": "a", "name": "Factories, workshops and warehouses", "description": "This publication is intended for Valuation Officers. It may contain links to internal resources that are not available through this version.", "text": "1. Scope 1.1 This guidance applies to factories, workshops and warehouses, there are separate practice notes for food processing centres, creameries, large distribution warehouses and large industrials linked to this section. Wholesale warehouses (Scat 301), self-storage hereditaments (Scat 721) and builders merchants (Scat 994) are the subject of separate manual sections. 2. List description and special category code 3. Responsible teams 3.1 Factories, workshops and warehouses are a generalist/regional class, large distribution warehouses are dealt with by the specialist/national teams. 3.2 It is recommended that each Unit should allocate a named co-ordinator to act as a point of contact within the Unit. This lead valuer will assist in the delivery of the Unit’s valuation scheme and also for liaising on value and technical issues with other lead valuers across adjoining Units. 4. Co-ordination Factories, workshops and warehouses (SCAT 096) fall within the responsibility of the Regional Industrial Class Coordination Team (CCT), along with many sub classes (e.g. Builders merchants, Tyre and exhaust Centres, Wholesale warehouses). Large distribution warehouses and Large industrials fall within the responsibility of the Industrial specialist - rentals CCT. Caseworkers have a responsibility to: - follow the advice contained within the Rating Manual and relevant practice note - seek advice from the co-ordination team before starting on any new work - not to depart from the guidance given on appeals or maintenance work, without approval from the co-ordination team"},
            {"identifier": "a", "name": "Complaints procedure", "description": "How to make a complaint about the Government Internal Audit Agency’s service.", "text": "The Government Internal Audit Agency (GIAA) is committed to giving professional, independent and objective advice and assurance to government and the public sector. We hope to always give the best possible service. However, we understand that sometimes there may be scenarios where we haven’t, and there is an opportunity for us to improve. The GIAA has a two stage complaints process. We do all we can to resolve your complaint at the first stage, but if you are not satisfied with our response, or you are unhappy with the way we have handled your complaint, you can ask for your complaint to be reviewed. How to complain and details of our procedure are set out below, along with how you can expect us to handle your complaint. How to make a complaint All complaints must be submitted in writing, either by email or letter, using the contact details below: Correspondence@giaa.gov.uk (mailto:Correspondence@giaa.gov.uk) Correspondence TeamGovernment Internal Audit Agency10 Victoria StreetLondonSW1H 0NB Please include your full name and contact details when submitting a complaint. Your complaint must clearly state the nature of the issue you wish to highlight to GIAA and provide any relevant details or supporting documentation. Complaints will be acknowledged within two working days of receipt. To ensure that issues are dealt with properly, any complaint should be made to us as soon as possible. Usually, we cannot investigate a complaint if it is raised with us more than 12 months after the date of the event being complained about, or the date that it was brought to your attention; whichever is the later date."},
        ]
        df = pd.DataFrame(data)

        tagged_df = classify_eu_themes(df)
        print(tagged_df[['name', 'predicted_themes']])

        expected = [["TRAN"], ["ENVI", "ENER"], [], [], []]
        result = tagged_df["predicted_themes"].tolist()
        self.assertEqual(result, expected)

if __name__ == "__main__":
    unittest.main()

